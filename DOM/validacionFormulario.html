<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
  
  <title>Dom manipulation</title>
</head>
<body>
  
  <div class="container vh-100">
    <div class="row h-100 justify-content-center align-items-center">
      
      <div class="col-6">
        <form action="">
          <div class="mb-3">
            <label for="Username" class="form-label">Username</label>
            <input type="text" class="form-control" id="Username">
            <div id="UserMessage" class="form-text"></div>
          </div>
          <div class="mb-3">
            <label for="Email" class="form-label">Email address</label>
            <input type="email" class="form-control" id="Email">
            <div id="EmailMessage" class="form-text"></div>
          </div>
          <div class="mb-3">
            <label for="Password" class="form-label">Password</label>
            <input type="password" class="form-control" id="Password">
            <div id="PasswordMessage" class="form-text"></div>
          </div>
          <div class="progress mb-3 px-0" style="width: 100%">
            <div class="progress-bar progress-bar-striped progress-bar-animated bg-dark progress-bar-1" role="progressbar" style="width: 0%"
            aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          
          <button type="button" class="btn btn-primary">Submit</button>
        </div>
        
        
      </form>
      
      
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>

  <script>
    
    const username = document.querySelector('#Username');
    const email = document.querySelector('#Email');
    const password = document.querySelector('#Password');
    const UserMessage = document.querySelector('#UserMessage');
    const PasswordMessage = document.querySelector('#PasswordMessage');
    const EmailMessage = document.querySelector('#EmailMessage');
    
    let rules = 0;
    
    username.addEventListener("change", () => {
      
      if (checkUsernameValidation(username.value)) {
        
        username.classList.remove('is-invalid')
        username.classList.add('is-valid')
        UserMessage.textContent = "valido"
        UserMessage.classList.remove('text-danger')
        UserMessage.classList.add('text-success')
        rules += 1
        progressValidation()
        
      } else {
        username.classList.remove('is-valid')
        username.classList.add('is-invalid')
        UserMessage.textContent = "Non valido"
        UserMessage.classList.remove('text-success')
        UserMessage.classList.add('text-danger')
      } 
      
      
    })
    
    email.addEventListener("change", () => {
      
      if (checkEmailValidation(email.value)) {
        
        email.classList.remove('is-invalid')
        email.classList.add('is-valid')
        EmailMessage.textContent = "valido"
        EmailMessage.classList.remove('text-danger')
        EmailMessage.classList.add('text-success')
        rules += 1
        progressValidation()
      } else {
        email.classList.remove('is-valid')
        email.classList.add('is-invalid')
        EmailMessage.textContent = "Non valido"
        EmailMessage.classList.remove('text-success')
        EmailMessage.classList.add('text-danger')
      } 
      
      
    })
    
    password.addEventListener("change", () => {
      
      if (checkPasswordValidation(password.value)) {
        
        password.classList.remove('is-invalid')
        password.classList.add('is-valid')
        PasswordMessage.textContent = "password valida"
        PasswordMessage.classList.remove('text-danger')
        PasswordMessage.classList.add('text-success')
        rules += 1
        progressValidation()
        
      } else {
        password.classList.remove('is-valid')
        password.classList.add('is-invalid')
        PasswordMessage.textContent = "Deve contenere una maiuscola, una miniscola e un numero"
        PasswordMessage.classList.remove('text-success')
        PasswordMessage.classList.add('text-danger')
      } 
    })
    
    
    function progressValidation() {
      let progressValues = [];    
      progressValues.push(rules)
      
      let progressBar = document.querySelector(".progress-bar-1");
      let progressForm = progressValues.reduce((a, b) => a + b, 0);
      
      switch (progressForm) {
        case 1:
        progressBar.style.width = "35%";
        progressBar.textContent = "35%";
        break;
        case 2:
        progressBar.style.width = "65%";
        progressBar.textContent = "65%";
        break;
        case 3:
        progressBar.style.width = "100%";
        progressBar.textContent = "100%";
        break;
        default:
        progressBar.style.width = "0%";
        progressBar.textContent = "0%";
        break;
      }
    }
    
    
    
    function checkUsernameValidation(str) {
      let caratteri = /[`!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~]/; 
      if (str.length >= 4 && !str.match(caratteri)) {
        return true;
      } else {
        return false;
      }
    }
    
    function checkEmailValidation(str) {
      let caratteri = /[`!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~]/; 
      if (str.length >= 4 && !str.match(caratteri)) {
        return true;
      } else {
        return false;
      }
    }
    
    
    
    function checkPasswordValidation(str) {
      let caratteri = /[ `!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~]/; 
      let regex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{4,10}$/
      if ( str.match(new RegExp(regex, 'gi')) ) {
        return true
      } else {
        return false
      }
    };
    
    
    
  </script>
  
  
</body>
</html>